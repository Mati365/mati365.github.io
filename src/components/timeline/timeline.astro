---
import TimelineYear from './timeline-year.astro';
import { COMPANIES } from './experience';

const years = Array.from(
  { length: 10 },
  (_, i) => new Date().getFullYear() - i
).reverse();

const getExperienceForYear = (year: number) =>
  COMPANIES.filter(({ duration }) => {
    const projectYear = duration.begin.getFullYear();
    const endYear = duration.end?.getFullYear() ?? new Date().getFullYear();
    return projectYear <= year && endYear >= year;
  });
---

<div class="mt-6 pt-4">
  <h2 class="mb-6 font-semibold text-2xl text-gray-900">Experience</h2>

  <table class="border-collapse [&_td]:border-gray-100 [&_td]:border-t w-full">
    <thead>
      <tr>
        <th class="border-gray-200 pr-6 border-r w-20"></th>
        <th class="pl-4 text-left">
          <div class="flex justify-between pb-2 text-gray-500 text-xs">
            {['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map(month => (
              <span>{month}</span>
            ))}
          </div>
        </th>
      </tr>
    </thead>
    <tbody>
      {years.map((year) => (
        <TimelineYear
          year={year}
          experience={getExperienceForYear(year)}
        />
      ))}
    </tbody>
  </table>
</div>

<script>
  document.querySelectorAll('.project-bar').forEach(bar => {
    bar.addEventListener('click', () => {
      const details = bar.getAttribute('data-details');
      // Możesz tutaj użyć własnej implementacji modala/tooltipa
      alert(details);
    });
  });
</script>
